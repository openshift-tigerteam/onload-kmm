apiVersion: kmm.sigs.x-k8s.io/v1beta1
kind: Module
metadata:
  name: onload
  namespace: onload-kmm
spec:
  selector:
    kubernetes.io/hostname: "<node>"
    #node-role.kubernetes.io/worker: ""
  moduleLoader:
    serviceAccountName: onload-kmm-sa
    container:
      modprobe:
        moduleName: onload
        args:
          sfc: ""
          sfc_char: ""
          sfc_tune: ""
      inTreeModulesToRemove: ["sfc"]

      kernelMappings:
        - regexp: '^.+$'
          containerImage: >-
            image-registry.openshift-image-registry.svc:5000/onload-kmm/onload-kmod:<srpm_version>-${KERNEL_FULL_VERSION}
          registryTLS:
            insecureSkipTLSVerify: true
          build:
            dockerfileConfigMap:
              name: onload-kmm-dockerfile
              key: dockerfile
            buildArgs:
              - name: SRPM_IMAGE
                value: default-route-openshift-image-registry.apps.<cluster>.<domain>/onload-kmm/onload-srpm:<srpm_version>
            secrets: 
              - name: etc-pki-entitlement
              - name: onload-signing-keys